# 汇编笔记

## 一、基础知识

### 1.1、机器简介

#### 1.1.1、寄存器

|寄存器|例子|功能|
|:-|:-|:-|
|数据寄存器|EAX、EBX、ECX、EDX|存放数据|
|指示器寄存器|ESI、EDI、ESP、EBP|存放偏移地址|

#### 1.1.2、指令部件

​	分为预取和译码，EIP总是保存着下一条将要取出指令的偏移地址

#### 1.1.3、分段部件&分页部件

​	主存辅存换入换出，6个16位段寄存器。

#### 1.1.4、3种工作方式

|方式|段和偏移|物理存储空间|程序段|说明|
|:-|:-|:-|:-|:-|
|实地址方式|16|1MB|64KB||
|保护方式|32|4GB，虚拟64TB|4GB|保护应用和OS|
|虚拟8086方式|32|4GB，虚拟64TB|4GB|同时支持16位|

### 1.3、主存储器和物理地址的形成

#### 1.3.1、主存



#### 1.3.2、堆栈

​	SS堆栈寄存器给出存储区位置；SP指向栈顶。

#### 1.3.3、物理地址形成



### 1.4、数据在计算机的表示形式



### 1.5、标志寄存器



## 二、寻址方式

|寻址方式|格式|范例|
|:-|:-|:-|
|直接寻址|R|AX|
|间接寻址|[R]|[SI]|
|变址寻址|[R\*a+b]、[R\*a]+b、b[R\*a]||
|基址加变址寻址|[BR+IR\*a+b]、b[BR]\[IR\*a]、b[BR+IR\*a]||
|立即寻址|n|3H|
|直接寻址|段寄存器:[n]、变量、变量+常量||

​	其中BR表示BX或者BP，

## 三、宏汇编语言

### 3.1、表达式

常量略

#### 3.1.1、 变量

（1）变量属性

1. 段属性：所在段的段首址
2. 偏移地址：段首址到该变量所占存储单元的字节距离
3. 变量类型：数据所需要的字节数

（2）变量定义

1. 格式：`[变量名] 数据定义伪指令 表达式[,...]`
2. 格式：`n DUP(表达式)`——将后面的表达式重复n次


```assembly
DATA 	SEGMENT 	USE16
A		DW		M;
BUF 	DB		'AB', 0DH, 0AH;
M		DB		2 DUP(1), 2 DUP(2, 'B'), '123'
...
DATA ENDS
```

#### 3.1.2、标号

机器指令语句存放地址的符号表示

（1）标号属性

1. 段属性
2. 偏移地址
3. 类型：NEAR用于本段，FAR无限制

（2）标号定义方式

```assembly

LOOP:	MOV AL, [SI];	近标号
SUB1:	PROC FAR;		远标号
SUB2:	PROC;			远标号
```

#### 3.1.3、地址表达式



### 3.2、指令

|指令|功能|
|:-|:-|
|1、传送操作||
|MOV|一般传送|
|MOVSX|类型转化为目标操作数相同类型|
|XCHG|一般交换|
|BSWAP|32位寄存器字节逆序|
|XADD|在正常加法之外还要把两个操作数的内容颠倒，画蛇添足|
|LEA|计算偏移地址之后传入（而非地址中的数据）|
|LDS||
|2、算术操作||
|INC|自增1|
|ADD|加|
|DEC|自减1|
|NEG|求补（取反加一）|
|SUB|减|
|CMP|（目标-源）来设置符号位|
|IMUL（双操作）|同类型，允许16/32|
|IMUL（三操作）|后两个相乘放在第一个|
|IMUL（单操作）|默认另一个乘数为EAX/AX/AL|
|MUL（单操作）|无符号，同上|
|CBW|AL符号扩展到AH|
|CWD|AX符号扩展到DX|
|CWDE|EAX扩展到EDX、EAX（64位）|
|IDIV|默认是用A寄存器，A保留商，AH或D保留余数|
|DIV|无符号，同上|
|3、按位操作||
|NOT|按位取反|
|AND|按位且|
|TEST|按位且并设置标志位|
|BT||
|OR|按位或|
|XOR|按位异或|
|||
|SAL、SAR|算数移|
|SHL、SHR|逻辑移|
|ROL、ROR|循环移|
|POL、POR|在左加入CF位|
|SHLD（三操作）|前两个操作数，左CF，循环左移|
|SHRD（三操作）|前两个操作数，右CF，循环右移|
### 3.3、伪指令

|伪指令|功能|
|:-|:-|
|1、处理器选择||
|2、数据定义||
|3、符号定义||
|符号名 EQU 表达式|类似宏定义|
|符号名 = 表达式|可以再定义，类似变量|
|变量名或标号 LABEL 类型||
|4、段定义||
|段名 SEGMENT \[使用类型\]\[定位方式\]\[组合方式\]\[类别\]|USE16或USE32表示段位|
|ASSUME 段寄存器:段名[,段寄存器:段名]|设定段寄存器与段的关系|
|$|表示正被翻译的位置，当前工作位置|
|ORG 数值表达式|更改当前工作位置，可以从喜欢的地方生成目标代码|
|3、源程序结束||
|END [表达式]|整个程序到此为止，后面的内容不会变成目标代码|
### 3.4、系统调用

```assembly
系统调用格式
MOV	AH, 调用编号
INT 21H （执行系统调用）
之前或中间需要加入一些额外的操作
```
|系统调用|附加指令|
|:-|:-|
|键盘输入1||
|显示输出2|MOV DL, 字符ASCII码|
|显示字符串9|LEA DX, 字符串首偏移地址|
|键盘输入字符串10|LEA DX, 缓冲区首偏移地址|

## 四、程序设计的基本方法










