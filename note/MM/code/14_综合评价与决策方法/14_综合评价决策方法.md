# 14、综合评价决策方法

## 14.1、TOPSIS法

​	多属性决策方案集为$D={d_1,d_2,...,d_m}$，衡量优劣的属性变量为$x_1,x_2,...,x_n$，每个决策d都有相应的向量表征方案。

​	假设最佳方案为$C^*$，最差方案为$C^0$，要选择尽可能靠近$C^*$，远离$C^0$的决策。

​	在属性空间定义距离测度就可以计算距离TOPSIS使用欧几里德距离。

```matlab
%ex14_1_3
clc, clear
a=[0.1	5	5000	4.7
 0.2	6	6000	5.6
 0.4	7	7000	6.7
 0.9	10	10000	2.3
 1.2	2	400	    1.8];
[m,n]=size(a);
x2=@(qujian,lb,ub,x)(1-(qujian(1)-x)./(qujian(1)-lb)).*(x>=lb & x<qujian(1))+(x>=qujian(1) & x<=qujian(2))+(1-(x-qujian(2))./(ub-qujian(2))).*(x>qujian(2) & x<=ub);
%设定最优区间和无法容忍的上下界
qujian=[5,6]; lb=2; ub=12;
a(:,2)=x2(qujian,lb,ub,a(:,2)); %对属性2进行变换
for j=1:n
    b(:,j)=a(:,j)/norm(a(:,j));  %向量规划化
end
%自行设定的权值
w=[0.2 0.3 0.4 0.1];
c=b.*repmat(w,m,1);      %求加权矩阵
%对成本型属性需要特别求一下
Cstar=max(c);    %求正理想解
Cstar(4)=min(c(:,4))  %属性4为成本型的
C0=min(c);       %q求负理想解
C0(4)=max(c(:,4))        %属性4为成本型的
for i=1:m
    Sstar(i)=norm(c(i,:)-Cstar);  %求到正理想解的距离
    S0(i)=norm(c(i,:)-C0);      %求到负理想的距离
end
f=S0./(Sstar+S0);
[sf,ind]=sort(f,'descend')       %求排序结果
```

	## 14.2、模糊综合评价

​	为了处理如人事考核这样的模糊问题

1. 确定因素集$U=\{u_1,u_2,...,u_n\}$，业绩，团队评价啥的；
2. 确定评语集$V=\{v_1,v_2,...,v_m\}$，好坏啥的；
3. 确定因素权重$A=[a_1,a_2,...,a_n]$，是一个模糊向量，和为1；
4. 确定模糊综合判断矩阵$R_{n*m}$，表示$U$到$V$的模糊关系矩阵；
5. 综合评判$B=AR$，得到$V$模糊向量；

### 多层次模糊综合评价

​	因素过多，权重难以分配；归一化条件也会让权重变得及其小。

1. 将因素集$U$分为子因素集$U_1、U_2、U_s$，作为对U的一个划分；
2. 对每个子因素集$U_i$做综合评判，得到一级评判向量$B_i$
3. 把每个$U_i$看作一个因素，对$K$做综合评判，得到二级评价向量$B$



​	其中一级评价向量需要每组内设计一个权重向量$A_i$，二级评价向量需要总共设计一个评价向量$A$。

## 14.3、数据包络分析DEA

​	评价多个决策单元（DMU），处理多指标输入和多指标输出的问题。

### $C^2R$模型

​	设有n个DMU，每个DMU都有m种投入和s种产出；向量$X_i,Y_j$分别表示决策单元j的输入和输出向量；$v$和$u$分别表示输入输出权值向量。定义决策单元$j$的效率评价模型：

​	$h_j=(u^TY_j)/(v^TX_j)​$

​	需要求解大量的线性规划。

​	DEA特别适合具有多输入和多输出的系统：

1. DEA以决策单位各输入/输出的权重为变量；
2. 不必确定输入输出的关系；
3. 无需权重假设，具有很大客观性



​	DEA是一种以凸优化和线性规划为工具的评价方法，结构简单，操作方便。

## 14.4、灰色关联分析法

​	针对决策上可以针对大量不确定性因素及其相关关系，将定性定量当法有机结合，使原本复杂的问题变得更加清晰简单，而且计算方便。

1. 确定m个比较对象，n个评价指标；
2. 确定各指标代表的权重，使用层次分析法确定权重；
3. 计算灰色关联系数，涉及一个分辨系数$\rho \in[0,1]$；
4. 计算灰色加权关联度$r_i$，表示第i个评价对象的；
5. 评价分析，排序；

```matlab
%ex14_5
%这里每列表示样本，每行表示一个属性
clc, clear
a=[0.83	 0.90	0.99	  0.92	0.87	  0.95
326	 295	 340  287	310	  303
21	 38	     25	  19	 27	  10
3.2	2.4	     2.2   2.0	 0.9   1.7
0.20	0.25	    0.12   0.33 	0.20	  0.09
0.15	0.20	    0.14   0.09	0.15   0.17
250	180	    300	   200	150   175
0.23	0.15	    0.27   0.30	0.18   0.26
0.87	0.95	    0.99	   0.89	0.82	  0.94];
for i=[1 5:9]    %效益型指标标准化
    a(i,:)=(a(i,:)-min(a(i,:)))/(max(a(i,:))-min(a(i,:)));
end
for i=2:4  %成本型指标标准化
   a(i,:)=(max(a(i,:))-a(i,:))/(max(a(i,:))-min(a(i,:))); 
end
[m,n]=size(a);
cankao=max(a')'  %求参考序列的取值
t=repmat(cankao,[1,n])-a;  %求参考序列与每一个序列的差
mmin=min(min(t));   %计算最小差
mmax=max(max(t));  %计算最大差
rho=0.5; %分辨系数
xishu=(mmin+rho*mmax)./(t+rho*mmax)  %计算灰色关联系数
guanliandu=mean(xishu)   %取等权重，计算关联度
[gsort,ind]=sort(guanliandu,'descend')  %对关联度按照从大到小排序
```

​	最后得到样本之间的降序排列，最大的是4号，表示其与虚拟最优关联最强；应该优先选择4号达到全体最优。

```bash
ind =

     4     3     6     2     5     1
```



## 14.5、主成分分析法

​	运用主成分分析对投资效益达到分析和排序

​	例子：行表示年份，每列表示收益和成本指标；

```matlab
clc,clear
gj=load('pjsj.txt');   %把原始数据保存在纯文本文件pjsj.txt中
gj=zscore(gj); %数据标准化
r=corrcoef(gj);  %计算相关系数矩阵
%下面利用相关系数矩阵进行主成分分析，x的列为r的特征向量，即主成分的系数
[x,y,z]=pcacov(r) %y为r的特征值，z为各个主成分的贡献率
f=repmat(sign(sum(x)),size(x,1),1); %构造与x同维数的元素为±1的矩阵
x=x.*f %修改特征向量的正负号，每个特征向量乘以所有分量和的符号函数值
num=3;  %num为选取的主成分的个数
df=gj*x(:,[1:num]);  %计算各个主成分的得分
tf=df*z(1:num)/100; %计算综合得分
[stf,ind]=sort(tf,'descend');  %把得分按照从高到低的次序排列
stf=stf', ind=ind'
```

​	最后结果表示每个年份的评价降序排名	

```bash
ind =

    10     9     8    11     4     7     1    17    12     5     2    13     3     6    14    16    15
```



## 14.6、秩和比综合评价法RSR

​	秩统计量举例：表示原来样本顺序在升序排列中的名次

```matlab
-0.8, -3.1, 1.1, -5.2, 4.2
-5.2, -3.1, -0.8, 1.1, 4.2

3, 2, 4, 1, 5
```

1. 把n个评价对象的m个评价指标排列成为n行m列的原始数据表，效益型指标从小到大编秩，成本型从大到小编秩；$R=(R_{ij})_{n*m}$

2. 计算秩和比RSR：$RSR_i=\frac{1}{mn}\sum_{j=1}^mR_{ij},i=1,2,...,n$

   加权秩和比WRSR：$WRSR_i==\frac{1}{mn}\sum_{j=1}^mw_jR_{ij},i=1,2,...,n$

   其中$\sum w=1$

3. 计算概率单位；

4. 计算直线回归方程；

5. 分档排序；

```matlab
%ex14_7
clc, clear
aw=load('zhb.txt'); %把x1,...,x6的数据和权重数据保存在纯文本文件zhb.txt中
w=aw(end,:); %提取权重向量
a=aw([1:end-1],:); %提取指标数据
a(:,[2,6])=-a(:,[2,6]); %把成本型指标转换成效益型指标
ra=tiedrank(a) %对每个指标值分别编秩，即对a的每一列分别编秩
[n,m]=size(ra); %计算矩阵sa的维数
RSR=mean(ra,2)/n  %计算秩和比
W=repmat(w,[n,1]);
WRSR=sum(ra.*W,2)/n  %计算加权秩和比
[sWRSR,ind]=sort(WRSR); %对加权秩和比排序 
p=[1:n]/n;    %计算累积频率
p(end)=1-1/(4*n) %修正最后一个累积频率，最后一个累积频率按1-1/(4*n)估计
Probit=norminv(p,0,1)+5  %计算标准正态分布的p分位数+5
X=[ones(n,1),Probit'];  %构造一元线性回归分析的数据矩阵
[ab,abint,r,rint,stats]=regress(sWRSR,X)  %一元线性回归分析
WRSRfit=ab(1)+ab(2)*Probit  %计算WRSR的估计值
y=[1983:1992]'; 
xlswrite('ex147.xls',[y(ind), ra(ind,:), sWRSR],1) %数据写入表单“Sheet1”中 
xlswrite('ex147.xls',[y(ind), ones(n,1), [1:n]', p', Probit', WRSRfit', [n:-1:1]'], 2) %数据写入表单“Sheet2”中 

```

